/*
 * Copyright (C) 2013,2014 Athom B.V. Jeroen Vollenbrock
 */
#include "imx6qdl-microsom.dtsi"
#include "imx6qdl-microsom-ar8035.dtsi"

/ {
	chosen {
		stdout-path = &uart1;
	};
	
	lirc_gpio {
		compatible = "lirc_gpio";
		gpios = <&gpio3 6 GPIO_ACTIVE_LOW &gpio3 7 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_homey_ir>;
	};
	
	leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_homey_leds>;

		usom {
			label = "usom-generc";
			gpios = <&gpio3 3 GPIO_ACTIVE_LOW>; /* Active low */
			default-state = "off";
			};
	};
	
	gpio_keys {
		compatible = "gpio-keys";
 
		recovery_switch {
			label = "Recovery mode";
			gpios = <&gpio2 20 GPIO_ACTIVE_LOW>;
			linux,input-type = <5>; /* EV_SW */
			linux,code = <0>; /* SW_LID */
			gpio-key,wakeup;
		};
	};

	regulators {
		compatible = "simple-bus";

		reg_3p3v: 3p3v {
			compatible = "regulator-fixed";
			regulator-name = "3P3V";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-always-on;
		};
		
		reg_1p8v: 1p8v {
			compatible = "regulator-fixed";
			regulator-name = "1P8V";
			regulator-min-microvolt = <1800000>;
			regulator-max-microvolt = <1800000>;
			regulator-always-on;
		};

		reg_usbh1_vbus: usb-h1-vbus {
			compatible = "regulator-fixed";
			enable-active-high;
			gpio = <&gpio1 0 GPIO_ACTIVE_HIGH>;
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_homey_usbh1_vbus>;
			regulator-name = "usb_h1_vbus";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
		};

		reg_usbotg_vbus: usb-otg-vbus {
			compatible = "regulator-fixed";
			enable-active-high;
			gpio = <&gpio3 22 GPIO_ACTIVE_HIGH>;
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_homey_usbotg_vbus>;
			regulator-name = "usb_otg_vbus";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
		};
	};
	
	usdhc3_pwrseq: usdhc3_pwrseq {
		compatible = "mmc-pwrseq-simple";
		reset-gpios = <&gpio7 8 GPIO_ACTIVE_LOW>;
	};

	sound-adau1761 {
		compatible = "fsl,imx-audio-adau1761";
		model = "imx-audio-adau1761";
		jack-detect-gpio = <&gpio7 12 GPIO_ACTIVE_HIGH>;
		audio-routing =
			"Aux Out", "LHP",
			"Aux Out", "RHP",
			"Homey Speaker", "LOUT",
			"LINP", "MIC 1",
			"LINN", "MIC 1",
			"RINP", "MIC 2",
			"RINN", "MIC 2",
			"MIC 1", "MICBIAS", /* enable VMIC for capture */
			"MIC 2", "MICBIAS"; /* enable VMIC for capture */
		audio-widgets = 
			"Microphone","MIC 1",
			"Microphone","MIC 2",
			"Line","Homey Speaker",
			"Headphone","Aux Out";
		mux-ext-port = <5>;
		mux-int-port = <1>;
		ssi-controller = <&ssi1>;
		audio-codec = <&adau1761>;
	};
};

&audmux {
	status = "okay";
};

&i2c1 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_homey_i2c1>;
	status = "okay";
};

&i2c2 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_homey_i2c2>;
	status = "okay";
};

&i2c3 {
	clock-frequency = <100000>;
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_homey_i2c3>;
	pinctrl-1 = <&pinctrl_homey_i2c3_gpio>;
	scl-gpios = <&gpio3 17 GPIO_ACTIVE_HIGH>;
	sda-gpios = <&gpio3 18 GPIO_ACTIVE_HIGH>;
	status = "okay";

	adau1761: adau1761@38 {
		compatible = "adi,adau1761";
		pinctrl-0 = <&pinctrl_homey_adau1761>;
		pinctrl-names = "default";
		reg = <0x38>;
		VDDA-supply = <&reg_3p3v>;
		VDDIO-supply = <&reg_3p3v>;
		
		clocks = <&clks IMX6QDL_CLK_CKO>;
	};
};

&iomuxc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_hog>;
	homey {
		pinctrl_hog: hoggrp {
			fsl,pins = <
				/*
				 * Homey v1 GPIO description. The pins 
				 * numbering as following -
				 * GPIO number | GPIO (bank,num) |  Function
				 * ------------+-----------------+------------
				 * gpio73	  | (3,9)		   | ZB_RESET
				 * gpio72	  | (3,8)		   | ZB_DEBUG_CLK
				 * gpio68	  | (3,4)		   | ZB_DEBUG_DAT
				 * gpio66	  | (3,2)		   | NFC_RESET
				 * gpio60	  | (2,28)		  | NFC_INT
				 * gpio50	  | (2,18)		  | UC_ERASE
				 * gpio52	  | (2,20)		  | UC_BOOT_M
				 * gpio90	  | (3,26)		  | UC_RESET
				 * gpio94	  | (3,30)		  | ZW_RESET
				 * gpio58	  | (2,26)		  | LED_USOM_SEL
				 * gpio204	 | (7,12)		  | ADAU_JD
				 *
				 * Notice the gpioX and GPIO (Y,Z) mapping forumla :
				 * X = (Y-1) * 32 + Z
				 */
				MX6QDL_PAD_EIM_DA9__GPIO3_IO09 0x1f0b1
				MX6QDL_PAD_EIM_DA8__GPIO3_IO08 0x130b1
				MX6QDL_PAD_EIM_DA4__GPIO3_IO04 0x400130b1
				MX6QDL_PAD_EIM_DA2__GPIO3_IO02 0x1f0b1
				
				MX6QDL_PAD_EIM_EB0__GPIO2_IO28 0x400130b1
				MX6QDL_PAD_EIM_A20__GPIO2_IO18 0x130b1
				MX6QDL_PAD_EIM_A18__GPIO2_IO20 0x1f0b1
				MX6QDL_PAD_EIM_D26__GPIO3_IO26 0x1f0b1
				MX6QDL_PAD_EIM_D30__GPIO3_IO30 0x1f0b1
				MX6QDL_PAD_EIM_RW__GPIO2_IO26  0x1f0b1
				MX6QDL_PAD_GPIO_17__GPIO7_IO12 0x1a0b1
			>;
		};
		
		pinctrl_homey_ir: homey-ir {
			fsl,pins = <
				MX6QDL_PAD_EIM_DA5__GPIO3_IO05 0x4001b0b1
				MX6QDL_PAD_EIM_DA6__GPIO3_IO06 0x4001b0b1
				MX6QDL_PAD_EIM_DA7__GPIO3_IO07 0x400130b1
			>;
		};
		
		pinctrl_homey_leds: homey-gpio-ledgroup {
			fsl,pins = <
				MX6QDL_PAD_EIM_DA3__GPIO3_IO03 0x80000000
			>;
		};

		pinctrl_homey_i2c1: homey-i2c1 {
			fsl,pins = <
				MX6QDL_PAD_EIM_D21__I2C1_SCL 0x4001b8b1
				MX6QDL_PAD_EIM_D28__I2C1_SDA 0x4001b8b1
			>;
		};

		pinctrl_homey_i2c2: homey-i2c2 {
			fsl,pins = <
				MX6QDL_PAD_KEY_COL3__I2C2_SCL 0x4001b8b1
				MX6QDL_PAD_KEY_ROW3__I2C2_SDA 0x4001b8b1
			>;
		};
		
		pinctrl_homey_i2c3: homey-i2c3 {
			fsl,pins = <
				MX6QDL_PAD_EIM_D17__I2C3_SCL 0x4001b8b1
				MX6QDL_PAD_EIM_D18__I2C3_SDA 0x4001b8b1
			>;
		};
		
		pinctrl_homey_i2c3_gpio: homey-i2c3_gpio {
			fsl,pins = <
				MX6QDL_PAD_EIM_D17__GPIO3_IO17 0x4001b8b1
				MX6QDL_PAD_EIM_D18__GPIO3_IO18 0x4001b8b1
			>;
		};

		pinctrl_homey_pwm1: pwm1grp {
			fsl,pins = <MX6QDL_PAD_DISP0_DAT8__PWM1_OUT 0x1b0b1>;
		};
		
		pinctrl_homey_ecspi2: homey-ecspi2 {
			fsl,pins = <
				MX6QDL_PAD_EIM_OE__ECSPI2_MISO 0x100b1
				MX6QDL_PAD_EIM_CS1__ECSPI2_MOSI 0x100b1
				MX6QDL_PAD_EIM_CS0__ECSPI2_SCLK 0x100b1
			>;
		};

		pinctrl_homey_adau1761: homey-adau1761 {
			fsl,pins = <
				MX6QDL_PAD_DISP0_DAT19__AUD5_RXD 0x130b0
				MX6QDL_PAD_KEY_COL0__AUD5_TXC 0x130b0
				MX6QDL_PAD_KEY_ROW0__AUD5_TXD 0x110b0
				MX6QDL_PAD_KEY_COL1__AUD5_TXFS 0x130b0
				MX6QDL_PAD_GPIO_5__CCM_CLKO1 0x130b0
			>;
		};

		pinctrl_homey_usbh1_vbus: homey-usbh1-vbus {
			fsl,pins = <MX6QDL_PAD_GPIO_0__GPIO1_IO00 0x1b0b0>;
		};

		pinctrl_homey_usbotg_id: homey-usbotg-id {
			/*
			 * Similar to pinctrl_usbotg_2, but we want it
			 * pulled down for a fixed host connection.
			 */
			fsl,pins = <MX6QDL_PAD_GPIO_1__USB_OTG_ID 0x1b0b0>;
		};

		pinctrl_homey_usbotg_vbus: homey-usbotg-vbus {
			fsl,pins = <MX6QDL_PAD_EIM_D22__GPIO3_IO22 0x1b0b0>;
		};

		pinctrl_homey_usdhc2_aux: homey-usdhc2-aux {
			fsl,pins = <
				MX6QDL_PAD_GPIO_4__GPIO1_IO04	0x1f071
			>;
		};

		pinctrl_homey_usdhc2: homey-usdhc2 {
			fsl,pins = <
				MX6QDL_PAD_SD2_CMD__SD2_CMD	0x17059
				MX6QDL_PAD_SD2_CLK__SD2_CLK	0x10059
				MX6QDL_PAD_SD2_DAT0__SD2_DATA0 0x17059
				MX6QDL_PAD_SD2_DAT1__SD2_DATA1 0x17059
				MX6QDL_PAD_SD2_DAT2__SD2_DATA2 0x17059
				MX6QDL_PAD_SD2_DAT3__SD2_DATA3 0x13059
			>;
		};
		
		pinctrl_homey_usdhc3_aux: homey-usdhc3-aux {
			fsl,pins = <
				MX6QDL_PAD_SD3_RST__GPIO7_IO08   0x1f071
			>;
		};
		
		pinctrl_homey_usdhc3: homey-usdhc3 {
			fsl,pins = <
				MX6QDL_PAD_SD3_CMD__SD3_CMD	0x17059
				MX6QDL_PAD_SD3_CLK__SD3_CLK	0x10059
				MX6QDL_PAD_SD3_DAT0__SD3_DATA0 0x17059
				MX6QDL_PAD_SD3_DAT1__SD3_DATA1 0x17059
				MX6QDL_PAD_SD3_DAT2__SD3_DATA2 0x17059
				MX6QDL_PAD_SD3_DAT3__SD3_DATA3 0x13059
			>;
		};

		pinctrl_homey_zwave: homey-zwave {
			fsl,pins = <
				MX6QDL_PAD_EIM_D24__UART3_TX_DATA	0x1b0b1
				MX6QDL_PAD_EIM_D25__UART3_RX_DATA	0x1b0b1
			>;
		};
		
		pinctrl_homey_zigbee: homey-zigbee {
			fsl,pins = <
				MX6QDL_PAD_SD4_DAT7__UART2_TX_DATA	0x1b0b1
				MX6QDL_PAD_SD4_DAT4__UART2_RX_DATA	0x1b0b1
				MX6QDL_PAD_SD4_DAT6__UART2_CTS_B	0x130b1
				MX6QDL_PAD_SD4_DAT5__UART2_RTS_B	0x130b1
			>;
		};
	};
};

&pwm1 {
	 status = "disabled";
};

&pwm2 {
	 status = "disabled";
};

/* ECSPI connected to ledring */
&ecspi2 {
  fsl,spi-num-chipselects = <2>;
  cs-gpios = <0>;
  pinctrl-names = "default";
  pinctrl-0 = <&pinctrl_homey_ecspi2>;
  status = "okay";

	spidev@0x00 {
		compatible = "spidev";
		spi-max-frequency = <20000000>;
		reg = <0>;
	};
};

/* SSI1 connected to ADAU1761 via ADMUX */
&ssi1 {
	compatible = "fsl,imx6-ssi", "fsl,imx51-ssi";
	/*fsl,fiq-stream-filter;*/
	status = "okay";
};

/* USBH1 connected to Atmel uC */
&usbh1 {
	disable-over-current;
	vbus-supply = <&reg_usbh1_vbus>;
	status = "okay";
};

/* USB OTG exported to back connector */
&usbotg {
	disable-over-current;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_homey_usbotg_id>;
	vbus-supply = <&reg_usbotg_vbus>;
	status = "okay";
};

/* Second uSDHC connected to debug sd-card slot */
/*&usdhc2 {
	pinctrl-names = "default";
	pinctrl-0 = <
		&pinctrl_homey_usdhc2_aux
		&pinctrl_homey_usdhc2
	>;
	vmmc-supply = <&reg_3p3v>;
	cd-gpios = <&gpio1 4 GPIO_ACTIVE_HIGH>;
	status = "okay";
};*/
&usdhc2 {
	status = "disabled";
};

/* Third uSDHC connected to main MMC card */
&usdhc3 {
	pinctrl-names = "default";
	pinctrl-0 = <
		&pinctrl_homey_usdhc2_aux
		&pinctrl_homey_usdhc3
	>;
	vmmc-supply = <&reg_1p8v>;
	mmc-pwrseq = <&usdhc3_pwrseq>;
	keep-power-in-suspend;
	non-removable;
	status = "okay";
	bus-width = <4>;
};

/* UART2 - Connected to Zigbee modem */
&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_homey_zigbee>;
	fsl,uart-has-rtscts;
	status = "okay";
	homey-zigbee;
};

/* UART3 - Connected to Z-Wave modem */
&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_homey_zwave>;
	status = "okay";
	homey-zwave;
};
